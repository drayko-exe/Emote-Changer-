-- Desbloqueio de FPS Máximo
if setfpscap then
    setfpscap(9999)
end

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "Menu de Modificações | drayko",
   LoadingTitle = "Carregando Scripts...",
   LoadingSubtitle = "by drayko",
   ConfigurationSaving = {
      Enabled = false
   }
})

-- ==========================================
-- VARIÁVEIS E CONFIGURAÇÕES
-- ==========================================
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Lighting = game:GetService("Lighting")
local player = Players.LocalPlayer

local bhopAtivo = false
local platAtiva = false
local modoVisivel = false
local ultimaPlataforma = nil
local LastJump = 0

-- Configurações de Movimentação (By drayko)
local JUMP_COOLDOWN = 0.15
local GROUND_CHECK_DISTANCE = 3.5
local MAX_SLOPE_ANGLE = 45

local pastaPlataformas = workspace:FindFirstChild("PlataformasInvisiveis") or Instance.new("Folder", workspace)
pastaPlataformas.Name = "PlataformasInvisiveis"

-- ==========================================
-- FUNÇÕES DE SUPORTE
-- ==========================================

local function IsOnGroundAdvanced()
    local Character = player.Character
    if not Character then return false end
    local Humanoid = Character:FindFirstChildOfClass("Humanoid")
    local HRP = Character:FindFirstChild("HumanoidRootPart")
    
    if not Humanoid or not HRP or Humanoid.Health <= 0 then return false end

    local raycastParams = RaycastParams.new()
    raycastParams.FilterType = Enum.RaycastFilterType.Exclude
    raycastParams.FilterDescendantsInstances = {Character}
    
    local rayOrigin = HRP.Position
    local rayDirection = Vector3.new(0, -GROUND_CHECK_DISTANCE, 0)
    local raycastResult = workspace:Raycast(rayOrigin, rayDirection, raycastParams)

    if not raycastResult then return false end

    local surfaceNormal = raycastResult.Normal
    local angle = math.deg(math.acos(surfaceNormal:Dot(Vector3.new(0, 1, 0))))
    return angle <= MAX_SLOPE_ANGLE
end

local function AdvancedRename(oldName, newName)
    for _, item in pairs(ReplicatedStorage:GetDescendants()) do
        if item.Name == oldName then
            item.Name = newName
        end
    end
end

-- ==========================================
-- ABA: SCRIPTS (Visuais e Movimentação)
-- ==========================================
local Tab = Window:CreateTab("Scripts", 4483362458)

Tab:CreateSection("Visual (Shaders)")

-- SHADER FUTURE REFLEX
Tab:CreateButton({
   Name = "Future Reflex Shaders by @drayko.exe",
   Callback = function()
        local function processObject(obj)
            if obj:IsA("BasePart") then
                obj.Material = Enum.Material.SmoothPlastic
                if obj.Transparency == 0 then obj.Reflectance = 0.6 end
            end
        end
        for _, obj in pairs(workspace:GetDescendants()) do processObject(obj) end
        workspace.DescendantAdded:Connect(processObject)

        local function applyLighting()
            for _, obj in pairs(Lighting:GetChildren()) do
                if obj:IsA("Sky") or obj:IsA("BloomEffect") or obj:IsA("Atmosphere") or obj:IsA("Clouds") then obj:Destroy() end
            end
            pcall(function()
                local objects = game:GetObjects("rbxassetid://95940878862689")
                for _, item in ipairs(objects) do item.Parent = Lighting end
            end)
            Lighting.Technology = Enum.Technology.Future
            Lighting.Brightness = 2.2
            Lighting.GlobalShadows = true
            Lighting.OutdoorAmbient = Color3.fromRGB(170, 130, 255)
        end
        applyLighting()
        
        local function addOutline(character)
            if not character then return end
            local highlight = Instance.new("Highlight")
            highlight.Name = "SkinOutline"
            highlight.FillTransparency = 1
            highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
            highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
            highlight.Parent = character
        end
        player.CharacterAdded:Connect(addOutline)
        if player.Character then addOutline(player.Character) end
        Rayfield:Notify({Title = "Shaders", Content = "Future Reflex Ativado!", Duration = 3})
   end,
})

-- LISTA DE LINKS
Tab:CreateButton({ Name = "Purple Shaders by @drayko.exe", Callback = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/drayko-exe/shaders-by-drayko.exe/refs/heads/main/shaders%20by%20%40drayko.exe"))() end })
Tab:CreateButton({ Name = "Red Shaders by @drayko.exe", Callback = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/drayko-exe/shaders-v2-by-drayko.exe/refs/heads/main/shaders%20v2"))() end })
Tab:CreateButton({ Name = "c00lk1dd shaders by @drayko.exe", Callback = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/drayko-exe/Shaders-Script-v3/refs/heads/main/Shaders%20v3%20by%20%40drayko.exe"))() end })
Tab:CreateButton({ Name = "SpongeBob Shaders by @drayko.exe", Callback = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/drayko-exe/shaders-v4-spongebob/refs/heads/main/Shaders%20by%20drayko.exe"))() end })
Tab:CreateButton({ Name = "Rainbow Shaders by @drayko.exe", Callback = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/drayko-exe/Shadeers-v5/refs/heads/main/by%20drayko"))() end })
Tab:CreateButton({ Name = "Blue Nebula Shaders by @drayko.exe", Callback = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/drayko-exe/Shaders-v6/refs/heads/main/made%20by%20me"))() end })
Tab:CreateButton({ Name = "WeirdCore Shaders by @drayko.exe", Callback = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/drayko-exe/Shaders-v7/refs/heads/main/made%20by%20%40drayko.exe"))() end })

Tab:CreateSection("Customização")
Tab:CreateButton({ Name = "Universal Avatar Changer", Callback = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/darkdexv2/universalavatarchanger/main/avatarchanger"))() end })

Tab:CreateSection("Movimentação")
Tab:CreateToggle({ Name = "Bhop (By drayko)", CurrentValue = false, Flag = "BhopToggle", Callback = function(Value) bhopAtivo = Value end })

Tab:CreateSection("Emotes")
Tab:CreateToggle({
   Name = "Renomear Emotes",
   CurrentValue = false,
   Flag = "EmoteToggle",
   Callback = function(Value)
      if Value then
         pcall(function()
            local emotesFolder = ReplicatedStorage:FindFirstChild("Items") and ReplicatedStorage.Items:FindFirstChild("Emotes")
            if emotesFolder then
                if emotesFolder:FindFirstChild("ZombieStride") then emotesFolder.ZombieStride.Name = "Robot" end
                if emotesFolder:FindFirstChild("catjam") then emotesFolder.catjam.Name = "ZombieStride" end
                if emotesFolder:FindFirstChild("Griddy") then emotesFolder.Griddy.Name = "SwagWalk" end
            end
            AdvancedRename("WerewolfHowl", "GoofyStride")
            AdvancedRename("Broom", "BumperKart")
            AdvancedRename("SkateboardStroll", "Nostalgia")
            AdvancedRename("RockinStride", "Stride")
         end)
      else
         pcall(function()
            AdvancedRename("ZombieStride", "catjam")
            AdvancedRename("Robot", "ZombieStride")
         end)
      end
   end,
})

-- ==========================================
-- ABA: MAPA, AJUSTES E PLATAFORMAS
-- ==========================================
local MapTab = Window:CreateTab("Mapa", 4483362458)
MapTab:CreateButton({
   Name = "Map Changer Brookhaven",
   Callback = function()
      local character = player.Character or player.CharacterAdded:Wait()
      local root = character:WaitForChild("HumanoidRootPart")
      root.Anchored = true
      root.CFrame = CFrame.new(root.Position.X, 15000, root.Position.Z)
      task.spawn(function()
          local success, objs = pcall(function() return game:GetObjects("rbxassetid://140334759443759") end)
          if success and objs[1] then
              objs[1].Parent = workspace
              task.wait(1)
              local targetPart = objs[1]:FindFirstChildWhichIsA("BasePart", true)
              root.CFrame = targetPart and CFrame.new(targetPart.Position.X, 15000, targetPart.Position.Z) or CFrame.new(0, 15000, 0)
          end
          root.Anchored = false
      end)
   end,
})

local ConfigTab = Window:CreateTab("Ajustes", 4483362458)

ConfigTab:CreateSection("Neblina (Fog Control)")

ConfigTab:CreateColorPicker({
    Name = "Cor da Neblina",
    Color = Color3.fromRGB(192, 192, 192),
    Callback = function(Value)
        Lighting.FogColor = Value
    end
})

ConfigTab:CreateSlider({
   Name = "Densidade/Distância (Fog Start)",
   Info = "Muda onde a neblina começa",
   Min = 0,
   Max = 5000,
   CurrentValue = 0,
   DisplayMethod = "Value",
   Callback = function(Value)
      Lighting.FogStart = Value
   end,
})

ConfigTab:CreateSlider({
   Name = "Limite da Visão (Fog End)",
   Info = "Muda onde a visão fica totalmente coberta",
   Min = 100,
   Max = 10000,
   CurrentValue = 10000,
   DisplayMethod = "Value",
   Callback = function(Value)
      Lighting.FogEnd = Value
   end,
})

ConfigTab:CreateSection("Outros")

ConfigTab:CreateButton({ Name = "Abrir FFlag Editor", Callback = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/Real-Link/Codex/main/FFlagEditor.lua"))() end })

local PlatTab = Window:CreateTab("Plataformas", 4483362458)
PlatTab:CreateToggle({
   Name = "Habilitar Teclas (E, Y, U)",
   CurrentValue = false,
   Callback = function(Value)
      platAtiva = Value
      if not Value then pastaPlataformas:ClearAllChildren() end
   end,
})

local SocialTab = Window:CreateTab("Social", 4483362458)
SocialTab:CreateButton({Name = "Copiar Discord", Callback = function() setclipboard("https://discord.gg/bqgVRCWm") end})
SocialTab:CreateButton({Name = "TikTok (@drayko.exe)", Callback = function() setclipboard("https://www.tiktok.com/@drayko.exe") end})

-- ==========================================
-- LOOPS E INPUTS
-- ==========================================
RunService.Heartbeat:Connect(function()
    if not bhopAtivo then return end
    local Char = player.Character
    if Char and Char:FindFirstChild("Humanoid") and UserInputService:IsKeyDown(Enum.KeyCode.Space) then
        if IsOnGroundAdvanced() and (tick() - LastJump) > JUMP_COOLDOWN then
            Char.Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
            LastJump = tick()
        end
    end
end)

local function criarMapa()
    local root = player.Character:WaitForChild("HumanoidRootPart")
    local altura = root.Position.Y - 3
    for x = -500, 500, 12 do
        for z = -500, 500, 12 do
            local p = Instance.new("Part", pastaPlataformas)
            p.Size, p.Position, p.Anchored = Vector3.new(12, 1, 12), Vector3.new(x, altura, z), true
            p.Transparency = modoVisivel and 0.3 or 1
            ultimaPlataforma = p
        end
    end
end

UserInputService.InputBegan:Connect(function(input, gp)
    if gp or not platAtiva then return end
    if input.KeyCode == Enum.KeyCode.E then if #pastaPlataformas:GetChildren() > 0 then pastaPlataformas:ClearAllChildren() else criarMapa() end end
    if input.KeyCode == Enum.KeyCode.Y then modoVisivel = not modoVisivel for _,p in pairs(pastaPlataformas:GetChildren()) do p.Transparency = modoVisivel and 0.3 or 1 end end
    if input.KeyCode == Enum.KeyCode.U and ultimaPlataforma then player.Character.HumanoidRootPart.CFrame = ultimaPlataforma.CFrame + Vector3.new(0, 3, 0) end
end)

Rayfield:LoadConfiguration()
