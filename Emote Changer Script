-- Desbloqueio de FPS Máximo
if setfpscap then
    setfpscap(9999)
end

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "Menu de Modificações | drayko",
   LoadingTitle = "Carregando Scripts...",
   LoadingSubtitle = "by drayko",
   ConfigurationSaving = {
      Enabled = false
   }
})

-- ==========================================
-- VARIÁVEIS E CONFIGURAÇÕES
-- ==========================================
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = Players.LocalPlayer

local bhopAtivo = false
local platAtiva = false
local modoVisivel = false
local ultimaPlataforma = nil
local LastJump = 0

local JUMP_COOLDOWN = 0.15
local GROUND_CHECK_DISTANCE = 3.5
local MAX_SLOPE_ANGLE = 45

local pastaPlataformas = workspace:FindFirstChild("PlataformasInvisiveis") or Instance.new("Folder", workspace)
pastaPlataformas.Name = "PlataformasInvisiveis"

-- ==========================================
-- FUNÇÕES DE SUPORTE
-- ==========================================

-- Busca para os outros emotes
local function AdvancedRename(oldName, newName)
    for _, item in pairs(ReplicatedStorage:GetDescendants()) do
        if item.Name == oldName then
            item.Name = newName
        end
    end
end

-- Lógica de Detecção de Chão do Yomka
local function IsOnGroundAdvanced()
    local Character = player.Character
    if not Character then return false end
    
    local Humanoid = Character:FindFirstChildOfClass("Humanoid")
    local HRP = Character:FindFirstChild("HumanoidRootPart")
    
    if not Humanoid or not HRP or Humanoid.Health <= 0 then return false end

    local state = Humanoid:GetState()
    if state == Enum.HumanoidStateType.Jumping or 
       state == Enum.HumanoidStateType.Freefall or
       state == Enum.HumanoidStateType.Swimming then
        return false
    end

    local raycastParams = RaycastParams.new()
    raycastParams.FilterType = Enum.RaycastFilterType.Blacklist
    raycastParams.FilterDescendantsInstances = {Character}
    raycastParams.IgnoreWater = true

    local rayOrigin = HRP.Position
    local rayDirection = Vector3.new(0, -GROUND_CHECK_DISTANCE, 0)
    local raycastResult = workspace:Raycast(rayOrigin, rayDirection, raycastParams)

    if not raycastResult then return false end

    local surfaceNormal = raycastResult.Normal
    local angle = math.deg(math.acos(surfaceNormal:Dot(Vector3.new(0, 1, 0))))

    return angle <= MAX_SLOPE_ANGLE
end

-- ==========================================
-- ABA: SCRIPTS
-- ==========================================
local Tab = Window:CreateTab("Scripts", 4483362458)

Tab:CreateSection("Movimentação")

Tab:CreateToggle({
   Name = "Bhop Automático (Yomka System)",
   CurrentValue = false,
   Flag = "BhopToggle",
   Callback = function(Value) bhopAtivo = Value end,
})

Tab:CreateSection("Emotes")

Tab:CreateToggle({
   Name = "Renomear Emotes",
   CurrentValue = false,
   Flag = "EmoteToggle",
   Callback = function(Value)
      if Value then
         pcall(function()
            -- Substituição solicitada: ZombieStride vira SwagWalk
            game:GetService("ReplicatedStorage").Items.Emotes.ZombieStride.Name = "SwagWalk"
            
            -- Griddy vira SwagWalk (conforme pedido anteriormente)
            game:GetService("ReplicatedStorage").Items.Emotes.Griddy.Name = "SwagWalk"
            
            -- Outros renomeares
            AdvancedRename("WerewolfHowl", "GoofyStride")
            AdvancedRename("Broom", "BumperKart")
            AdvancedRename("SkateboardStroll", "Nostalgia")
            AdvancedRename("RockinStride", "Stride")
         end)
         Rayfield:Notify({Title = "Emotes", Content = "Emotes Modificados!", Duration = 2})
      else
         pcall(function()
            -- Restaurando
            game:GetService("ReplicatedStorage").Items.Emotes.SwagWalk.Name = "ZombieStride"
            -- Obs: Se houver dois com o mesmo nome (SwagWalk), o pcall ajuda a não crashar
            AdvancedRename("GoofyStride", "WerewolfHowl")
            AdvancedRename("BumperKart", "Broom")
            AdvancedRename("Nostalgia", "SkateboardStroll")
            AdvancedRename("Stride", "RockinStride")
         end)
      end
   end,
})

-- ==========================================
-- ABA: AJUSTES E MAPA
-- ==========================================
local ConfigTab = Window:CreateTab("Ajustes", 4483362458)
ConfigTab:CreateButton({
   Name = "Abrir FFlag Editor",
   Callback = function()
      loadstring(game:HttpGet("https://raw.githubusercontent.com/Real-Link/Codex/main/FFlagEditor.lua"))()
   end,
})

-- Loop Heartbeat para o BHOP
RunService.Heartbeat:Connect(function()
    if not bhopAtivo then return end
    
    local Character = player.Character
    if Character then
        local Humanoid = Character:FindFirstChildOfClass("Humanoid")
        if Humanoid and Humanoid.Health > 0 and UserInputService:IsKeyDown(Enum.KeyCode.Space) then
            if IsOnGroundAdvanced() and (tick() - LastJump) > JUMP_COOLDOWN then
                Humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
                LastJump = tick()
            end
        end
    end
end)

Rayfield:LoadConfiguration()
